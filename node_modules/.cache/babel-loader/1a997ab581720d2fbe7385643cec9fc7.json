{"ast":null,"code":"var _jsxFileName = \"/home/ec2-user/environment/myapp/src/App.js\";\nimport React, { useEffect, useReducer, useState } from 'react';\nimport API, { graphqlOperation } from '@aws-amplify/api';\nimport Amplify, { PubSub, Predictions } from 'aws-amplify';\nimport { AWSIoTProvider } from '@aws-amplify/pubsub/lib/Providers';\nimport { AmazonAIPredictionsProvider } from '@aws-amplify/predictions';\nimport TextLoop from \"react-text-loop\";\nimport cxs from \"cxs/component\";\nimport mic from 'microphone-stream';\nimport AWS_logo from \"./images/AWS_logo_RGB_WHT.png\"; // Spinner lib\n\nimport { WaveSpinner } from \"react-spinners-kit\";\nimport awsconfig from './aws-exports';\nimport './App.css'; // IoT subscription\n\nAmplify.configure({\n  Auth: {\n    identityPoolId: process.env.REACT_APP_IDENTITY_POOL_ID,\n    region: process.env.REACT_APP_REGION,\n    userPoolId: process.env.REACT_APP_USER_POOL_ID,\n    userPoolWebClientId: process.env.REACT_APP_USER_POOL_WEB_CLIENT_ID\n  },\n  predictions: {\n    convert: {\n      transcription: {\n        region: \"us-east-1\",\n        proxy: false,\n        defaults: {\n          \"language\": \"en-US\"\n        }\n      }\n    }\n  }\n});\nAmplify.addPluggable(new AWSIoTProvider({\n  aws_pubsub_region: process.env.REACT_APP_REGION,\n  aws_pubsub_endpoint: `wss://${process.env.REACT_APP_MQTT_ID}.iot.${process.env.REACT_APP_REGION}.amazonaws.com/mqtt`\n}));\nAmplify.addPluggable(new AmazonAIPredictionsProvider());\nconst StyledTextLoop = cxs(TextLoop)({\n  display: \"block\"\n});\n\nfunction SpeechToText(props) {\n  const [response, setResponse] = useState(\"Question from attendee will be displayed here.\");\n\n  function AudioRecorder(props) {\n    const [recording, setRecording] = useState(false);\n    const [micStream, setMicStream] = useState();\n    const [audioBuffer] = useState(function () {\n      let buffer = [];\n\n      function add(raw) {\n        buffer = buffer.concat(...raw);\n        return buffer;\n      }\n\n      function newBuffer() {\n        console.log(\"reseting buffer\");\n        buffer = [];\n      }\n\n      return {\n        reset: function () {\n          newBuffer();\n        },\n        addData: function (raw) {\n          return add(raw);\n        },\n        getData: function () {\n          return buffer;\n        }\n      };\n    }());\n\n    async function startRecording() {\n      console.log('start recording');\n      audioBuffer.reset();\n      window.navigator.mediaDevices.getUserMedia({\n        video: false,\n        audio: true\n      }).then(stream => {\n        const startMic = new mic();\n        startMic.setStream(stream);\n        startMic.on('data', chunk => {\n          var raw = mic.toRaw(chunk);\n\n          if (raw == null) {\n            return;\n          }\n\n          var audiobuf = audioBuffer.addData(raw);\n        });\n        setRecording(true);\n        setMicStream(startMic);\n      });\n    }\n\n    async function stopRecording() {\n      console.log('stop recording');\n      const {\n        finishRecording\n      } = props;\n      micStream.stop();\n      setMicStream(null);\n      setRecording(false);\n      const resultBuffer = audioBuffer.getData();\n\n      if (typeof finishRecording === \"function\") {\n        finishRecording(resultBuffer);\n      }\n    }\n\n    return React.createElement(\"div\", {\n      className: \"audioRecorder\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, recording && React.createElement(\"button\", {\n      onClick: stopRecording,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, \"Stop recording\"), !recording && React.createElement(\"button\", {\n      onClick: startRecording,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, \"Start recording\")));\n  }\n\n  function convertFromBuffer(bytes) {\n    setResponse('Converting text...');\n    Predictions.convert({\n      transcription: {\n        source: {\n          bytes\n        } // language: \"en-US\", // other options are \"en-GB\", \"fr-FR\", \"fr-CA\", \"es-US\"\n\n      }\n    }).then(({\n      transcription: {\n        fullText\n      }\n    }) => {\n      setResponse(fullText);\n      console.log(fullText);\n    }).catch(err => setResponse(JSON.stringify(err, null, 2)));\n  }\n\n  return React.createElement(\"div\", {\n    className: \"Text\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, React.createElement(AudioRecorder, {\n    finishRecording: convertFromBuffer,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }), React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, response)));\n}\n\nclass LCD extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      datalcd: null,\n      status: 0\n    };\n\n    this.getSub = () => {\n      const datalcd = Amplify.PubSub.subscribe('lcd-message').subscribe({\n        next: data => {\n          var answer = JSON.stringify(data);\n          console.log('answer: ', answer);\n          var objectValue = JSON.parse(answer);\n          var messageiot = objectValue['value'].message;\n          console.log('tip: ', messageiot);\n          var presenceiot = objectValue['value'].presence;\n          console.log('status: ', presenceiot);\n          this.setState({\n            datalcd: messageiot,\n            status: presenceiot\n          });\n        },\n        error: error => console.error(error),\n        close: () => console.log('Done')\n      });\n    };\n  }\n\n  componentDidMount() {\n    this.getSub();\n  }\n\n  render() {\n    const {\n      datalcd,\n      status\n    } = this.state;\n    const {\n      loading\n    } = this.state;\n    const welcome = 'How can I help?';\n    return React.createElement(\"div\", {\n      className: \"App\",\n      style: {\n        height: \"130vh\",\n        justifyContent: 'center'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197\n      },\n      __self: this\n    }, React.createElement(SpeechToText, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"Message\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }, status === 1 ? \"Hi!\\nHow can I help?\" : React.createElement(TextLoop, {\n      interval: \"4000\",\n      fade: \"true\",\n      children: [\"ASK ME\", React.createElement(\"img\", {\n        src: AWS_logo,\n        alt: \"Logo\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      })],\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    })), this.data);\n  }\n\n}\n\nfunction App() {\n  return React.createElement(\"div\", {\n    className: \"App\",\n    style: {\n      height: \"100vh\",\n      justifyContent: 'center'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"Message\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217\n    },\n    __self: this\n  }, React.createElement(TextLoop, {\n    interval: \"4000\",\n    fade: \"true\",\n    children: [\"How can I help?\", \"\t¿Cómo puedo ayudarte?\", React.createElement(\"img\", {\n      src: AWS_logo,\n      alt: \"Logo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    })],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218\n    },\n    __self: this\n  })), this.data);\n}\n\nexport default LCD;","map":{"version":3,"sources":["/home/ec2-user/environment/myapp/src/App.js"],"names":["React","useEffect","useReducer","useState","API","graphqlOperation","Amplify","PubSub","Predictions","AWSIoTProvider","AmazonAIPredictionsProvider","TextLoop","cxs","mic","AWS_logo","WaveSpinner","awsconfig","configure","Auth","identityPoolId","process","env","REACT_APP_IDENTITY_POOL_ID","region","REACT_APP_REGION","userPoolId","REACT_APP_USER_POOL_ID","userPoolWebClientId","REACT_APP_USER_POOL_WEB_CLIENT_ID","predictions","convert","transcription","proxy","defaults","addPluggable","aws_pubsub_region","aws_pubsub_endpoint","REACT_APP_MQTT_ID","StyledTextLoop","display","SpeechToText","props","response","setResponse","AudioRecorder","recording","setRecording","micStream","setMicStream","audioBuffer","buffer","add","raw","concat","newBuffer","console","log","reset","addData","getData","startRecording","window","navigator","mediaDevices","getUserMedia","video","audio","then","stream","startMic","setStream","on","chunk","toRaw","audiobuf","stopRecording","finishRecording","stop","resultBuffer","convertFromBuffer","bytes","source","fullText","catch","err","JSON","stringify","LCD","Component","state","datalcd","status","getSub","subscribe","next","data","answer","objectValue","parse","messageiot","message","presenceiot","presence","setState","error","close","componentDidMount","render","loading","welcome","height","justifyContent","App"],"mappings":"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","sourcesContent":["import React, { useEffect, useReducer, useState } from 'react';\n\nimport API, { graphqlOperation } from '@aws-amplify/api';\nimport Amplify, { PubSub, Predictions } from 'aws-amplify';\nimport { AWSIoTProvider } from '@aws-amplify/pubsub/lib/Providers';\nimport { AmazonAIPredictionsProvider } from '@aws-amplify/predictions';\n\n\nimport TextLoop from \"react-text-loop\";\nimport cxs from \"cxs/component\";\n\nimport mic from 'microphone-stream';\n\nimport AWS_logo from \"./images/AWS_logo_RGB_WHT.png\"\n\n// Spinner lib\nimport { WaveSpinner } from \"react-spinners-kit\";\n\n\nimport awsconfig from './aws-exports';\nimport './App.css';\n\n// IoT subscription\n\nAmplify.configure({\n  Auth: {\n    identityPoolId: process.env.REACT_APP_IDENTITY_POOL_ID,\n    region: process.env.REACT_APP_REGION,\n    userPoolId: process.env.REACT_APP_USER_POOL_ID,\n    userPoolWebClientId: process.env.REACT_APP_USER_POOL_WEB_CLIENT_ID,\n  },\n  predictions: {\n        convert: {\n            transcription: {\n                region: \"us-east-1\",\n                proxy: false,\n                defaults: {\n                    \"language\": \"en-US\"\n                }\n            }\n        }\n    }\n});\n\nAmplify.addPluggable(new AWSIoTProvider({\n  aws_pubsub_region: process.env.REACT_APP_REGION,\n  aws_pubsub_endpoint: `wss://${process.env.REACT_APP_MQTT_ID}.iot.${process.env.REACT_APP_REGION}.amazonaws.com/mqtt`,\n}));\n\nAmplify.addPluggable(new AmazonAIPredictionsProvider());\n\n\nconst StyledTextLoop = cxs(TextLoop)({\n  display: \"block\"\n});\n\n\nfunction SpeechToText(props) {\n  const [response, setResponse] = useState(\"Question from attendee will be displayed here.\")\n  \n  function AudioRecorder(props) {\n    const [recording, setRecording] = useState(false);\n    const [micStream, setMicStream] = useState();\n    const [audioBuffer] = useState(\n      (function() {\n        let buffer = [];\n        function add(raw) {\n          buffer = buffer.concat(...raw);\n          return buffer;\n        }\n        function newBuffer() {\n          console.log(\"reseting buffer\");\n          buffer = [];\n        }\n \n        return {\n          reset: function() {\n            newBuffer();\n          },\n          addData: function(raw) {\n            return add(raw);\n          },\n          getData: function() {\n            return buffer;\n          }\n        };\n      })()\n    );\n\n    async function startRecording() {\n      console.log('start recording');\n      audioBuffer.reset();\n\n      window.navigator.mediaDevices.getUserMedia({ video: false, audio: true }).then((stream) => {\n        const startMic = new mic();\n\n        startMic.setStream(stream);\n        startMic.on('data', (chunk) => {\n          var raw = mic.toRaw(chunk);\n          if (raw == null) {\n            return;\n          }\n          var audiobuf = audioBuffer.addData(raw);\n\n        });\n        \n        setRecording(true);\n        setMicStream(startMic);\n      });\n    }\n\n    async function stopRecording() {\n      console.log('stop recording');\n      const { finishRecording } = props;\n\n      micStream.stop();\n      setMicStream(null);\n      setRecording(false);\n\n      const resultBuffer = audioBuffer.getData();\n\n      if (typeof finishRecording === \"function\") {\n        finishRecording(resultBuffer);\n      }\n\n    }\n\n    return (\n      <div className=\"audioRecorder\">\n        <div>\n          {recording && <button onClick={stopRecording}>Stop recording</button>}\n          {!recording && <button onClick={startRecording}>Start recording</button>}\n        </div>\n      </div>\n    );\n  }\n\n  function convertFromBuffer(bytes) {\n    setResponse('Converting text...');\n    \n    Predictions.convert({\n      transcription: {\n        source: {\n          bytes\n        },\n        // language: \"en-US\", // other options are \"en-GB\", \"fr-FR\", \"fr-CA\", \"es-US\"\n      },\n    }).then(({ transcription: { fullText } }) => {\n        setResponse(fullText);\n        console.log(fullText);\n          })\n      .catch(err => setResponse(JSON.stringify(err, null, 2)));\n  }\n\n  return (\n    <div className=\"Text\">\n      <div>\n        <AudioRecorder finishRecording={convertFromBuffer} />\n        <p>{response}</p>\n      </div>\n    </div>\n  );\n}\n\n\nclass LCD extends React.Component {\n  state = {\n    datalcd: null,\n    status: 0\n  }\n  \n  componentDidMount() {\n    this.getSub()\n  }\n    getSub = () => {\n   const datalcd = Amplify.PubSub.subscribe('lcd-message').subscribe({\n  next: data => {\n    var answer = JSON.stringify(data);\n    console.log('answer: ', answer);\n    var objectValue = JSON.parse(answer);\n    var messageiot = objectValue['value'].message;\n    console.log('tip: ', messageiot);\n    var presenceiot = objectValue['value'].presence;\n    console.log('status: ', presenceiot);\n    this.setState({datalcd: messageiot, status: presenceiot});\n  },\n  error: error => console.error(error),\n  close: () => console.log('Done'),\n});\n  }\n\n  render(){\n    const {datalcd, status} = this.state;\n      const { loading } = this.state;\n    const welcome = 'How can I help?';\n    return (\n      <div className=\"App\"style = {{height:\"130vh\", justifyContent: 'center'}}>\n      <SpeechToText />\n\n      <div className=\"Message\">\n      {(status === 1) ? \"Hi!\\nHow can I help?\" : <TextLoop interval='4000' fade='true' children={[\"ASK ME\", <img src={AWS_logo} alt=\"Logo\" />]} /> }\n       </div>\n       \n       {this.data}\n      </div>\n    );\n  }\n}\n\n\nfunction App() {\n\n  return (\n    <div className=\"App\"style = {{height:\"100vh\", justifyContent: 'center'}}>\n      {/*<button onClick={createNewTodo}>Add Todo</button>*/}\n\n      <div className=\"Message\">\n      <TextLoop interval='4000' fade='true' children={[\"How can I help?\", \"\t¿Cómo puedo ayudarte?\",<img src={AWS_logo} alt=\"Logo\" />]} />\n       </div>\n       {this.data}\n    </div>\n  );\n}\n\nexport default LCD;\n\n\n"]},"metadata":{},"sourceType":"module"}