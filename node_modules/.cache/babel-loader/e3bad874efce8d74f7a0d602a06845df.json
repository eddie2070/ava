{"ast":null,"code":"import _classCallCheck from\"/home/ec2-user/environment/myapp/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/ec2-user/environment/myapp/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/ec2-user/environment/myapp/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/ec2-user/environment/myapp/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/ec2-user/environment/myapp/node_modules/@babel/runtime/helpers/esm/inherits\";import _regeneratorRuntime from\"/home/ec2-user/environment/myapp/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ec2-user/environment/myapp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/home/ec2-user/environment/myapp/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/ec2-user/environment/myapp/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useReducer,useState}from'react';import API,{graphqlOperation}from'@aws-amplify/api';import Amplify,{PubSub,Predictions}from'aws-amplify';import{AWSIoTProvider}from'@aws-amplify/pubsub/lib/Providers';import{AmazonAIPredictionsProvider}from'@aws-amplify/predictions';import TextLoop from\"react-text-loop\";import cxs from\"cxs/component\";import mic from'microphone-stream';import AWS_logo from\"./images/AWS_logo_RGB_WHT.png\";// Spinner lib\nimport{WaveSpinner}from\"react-spinners-kit\";import awsconfig from'./aws-exports';import'./App.css';// IoT subscription\nAmplify.configure({Auth:{identityPoolId:process.env.REACT_APP_IDENTITY_POOL_ID,region:process.env.REACT_APP_REGION,userPoolId:process.env.REACT_APP_USER_POOL_ID,userPoolWebClientId:process.env.REACT_APP_USER_POOL_WEB_CLIENT_ID},predictions:{convert:{transcription:{region:\"us-east-1\",proxy:false,defaults:{\"language\":\"en-US\"}}}}});Amplify.addPluggable(new AWSIoTProvider({aws_pubsub_region:process.env.REACT_APP_REGION,aws_pubsub_endpoint:\"wss://\".concat(process.env.REACT_APP_MQTT_ID,\".iot.\").concat(process.env.REACT_APP_REGION,\".amazonaws.com/mqtt\")}));Amplify.addPluggable(new AmazonAIPredictionsProvider());var StyledTextLoop=cxs(TextLoop)({display:\"block\"});function SpeechToText(props){var _useState=useState(\"Question from attendee will be displayed here.\"),_useState2=_slicedToArray(_useState,2),response=_useState2[0],setResponse=_useState2[1];function AudioRecorder(props){var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),recording=_useState4[0],setRecording=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),micStream=_useState6[0],setMicStream=_useState6[1];var _useState7=useState(function(){var buffer=[];function add(raw){var _buffer;buffer=(_buffer=buffer).concat.apply(_buffer,_toConsumableArray(raw));return buffer;}function newBuffer(){console.log(\"reseting buffer\");buffer=[];}return{reset:function reset(){newBuffer();},addData:function addData(raw){return add(raw);},getData:function getData(){return buffer;}};}()),_useState8=_slicedToArray(_useState7,1),audioBuffer=_useState8[0];function startRecording(){return _startRecording.apply(this,arguments);}function _startRecording(){_startRecording=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log('start recording');audioBuffer.reset();window.navigator.mediaDevices.getUserMedia({video:false,audio:true}).then(function(stream){var startMic=new mic();startMic.setStream(stream);startMic.on('data',function(chunk){var raw=mic.toRaw(chunk);if(raw==null){return;}audioBuffer.addData(raw);});setRecording(true);setMicStream(startMic);});case 3:case\"end\":return _context.stop();}}},_callee);}));return _startRecording.apply(this,arguments);}function stopRecording(){return _stopRecording.apply(this,arguments);}function _stopRecording(){_stopRecording=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var finishRecording,resultBuffer;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log('stop recording');finishRecording=props.finishRecording;micStream.stop();setMicStream(null);setRecording(false);resultBuffer=audioBuffer.getData();if(typeof finishRecording===\"function\"){finishRecording(resultBuffer);}case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _stopRecording.apply(this,arguments);}return React.createElement(\"div\",{className:\"audioRecorder\"},React.createElement(\"div\",null,recording&&React.createElement(\"button\",{onClick:stopRecording},\"Stop recording\"),!recording&&React.createElement(\"button\",{onClick:startRecording},\"Start recording\")));}function convertFromBuffer(bytes){setResponse('Converting text...');Predictions.convert({transcription:{source:{bytes:bytes}// language: \"en-US\", // other options are \"en-GB\", \"fr-FR\", \"fr-CA\", \"es-US\"\n}}).then(function(_ref){var fullText=_ref.transcription.fullText;setResponse(fullText);console.log(fullText);}).catch(function(err){return setResponse(JSON.stringify(err,null,2));});}return React.createElement(\"div\",{className:\"Text\"},React.createElement(\"div\",null,React.createElement(AudioRecorder,{finishRecording:convertFromBuffer}),\"// \",React.createElement(AudioRecorder,{finishRecording:convertFromBuffer}),React.createElement(\"p\",null,response)));}var LCD=/*#__PURE__*/function(_React$Component){_inherits(LCD,_React$Component);function LCD(){var _getPrototypeOf2;var _this;_classCallCheck(this,LCD);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(LCD)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={datalcd:null,status:'idle'};_this.getSub=function(){var datalcd=Amplify.PubSub.subscribe('lcd-message').subscribe({next:function next(data){var answer=JSON.stringify(data);var objectValue=JSON.parse(answer);var messageiot=objectValue['value'].message;console.log('tip: ',messageiot);_this.setState({datalcd:messageiot,status:'presence'});},error:function error(_error){return console.error(_error);},close:function close(){return console.log('Done');}});};return _this;}_createClass(LCD,[{key:\"componentDidMount\",value:function componentDidMount(){this.getSub();}},{key:\"render\",value:function render(){var _this$state=this.state,datalcd=_this$state.datalcd,status=_this$state.status;var loading=this.state.loading;return React.createElement(\"div\",{className:\"App\",style:{height:\"130vh\",justifyContent:'center'}},React.createElement(SpeechToText,null),React.createElement(\"div\",{className:\"Message\"},status==\"idle\"?React.createElement(TextLoop,{interval:\"4000\",fade:\"true\",children:[\"How can I help?\",\"\t¿Cómo puedo ayudarte?\",React.createElement(\"img\",{src:AWS_logo,alt:\"Logo\"})]}):\"AVA: \".concat(datalcd)),this.data);}}]);return LCD;}(React.Component);function App(){return React.createElement(\"div\",{className:\"App\",style:{height:\"100vh\",justifyContent:'center'}},React.createElement(\"div\",{className:\"Message\"},React.createElement(TextLoop,{interval:\"4000\",fade:\"true\",children:[\"How can I help?\",\"\t¿Cómo puedo ayudarte?\",React.createElement(\"img\",{src:AWS_logo,alt:\"Logo\"})]})),this.data);}export default LCD;","map":{"version":3,"sources":["/home/ec2-user/environment/myapp/src/App.js"],"names":["React","useEffect","useReducer","useState","API","graphqlOperation","Amplify","PubSub","Predictions","AWSIoTProvider","AmazonAIPredictionsProvider","TextLoop","cxs","mic","AWS_logo","WaveSpinner","awsconfig","configure","Auth","identityPoolId","process","env","REACT_APP_IDENTITY_POOL_ID","region","REACT_APP_REGION","userPoolId","REACT_APP_USER_POOL_ID","userPoolWebClientId","REACT_APP_USER_POOL_WEB_CLIENT_ID","predictions","convert","transcription","proxy","defaults","addPluggable","aws_pubsub_region","aws_pubsub_endpoint","REACT_APP_MQTT_ID","StyledTextLoop","display","SpeechToText","props","response","setResponse","AudioRecorder","recording","setRecording","micStream","setMicStream","buffer","add","raw","concat","newBuffer","console","log","reset","addData","getData","audioBuffer","startRecording","window","navigator","mediaDevices","getUserMedia","video","audio","then","stream","startMic","setStream","on","chunk","toRaw","stopRecording","finishRecording","stop","resultBuffer","convertFromBuffer","bytes","source","fullText","catch","err","JSON","stringify","LCD","state","datalcd","status","getSub","subscribe","next","data","answer","objectValue","parse","messageiot","message","setState","error","close","loading","height","justifyContent","Component","App"],"mappings":"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","sourcesContent":["import React, { useEffect, useReducer, useState } from 'react';\n\nimport API, { graphqlOperation } from '@aws-amplify/api';\nimport Amplify, { PubSub, Predictions } from 'aws-amplify';\nimport { AWSIoTProvider } from '@aws-amplify/pubsub/lib/Providers';\nimport { AmazonAIPredictionsProvider } from '@aws-amplify/predictions';\n\n\nimport TextLoop from \"react-text-loop\";\nimport cxs from \"cxs/component\";\n\nimport mic from 'microphone-stream';\n\nimport AWS_logo from \"./images/AWS_logo_RGB_WHT.png\"\n\n// Spinner lib\nimport { WaveSpinner } from \"react-spinners-kit\";\n\n\nimport awsconfig from './aws-exports';\nimport './App.css';\n\n// IoT subscription\n\nAmplify.configure({\n  Auth: {\n    identityPoolId: process.env.REACT_APP_IDENTITY_POOL_ID,\n    region: process.env.REACT_APP_REGION,\n    userPoolId: process.env.REACT_APP_USER_POOL_ID,\n    userPoolWebClientId: process.env.REACT_APP_USER_POOL_WEB_CLIENT_ID,\n  },\n  predictions: {\n        convert: {\n            transcription: {\n                region: \"us-east-1\",\n                proxy: false,\n                defaults: {\n                    \"language\": \"en-US\"\n                }\n            }\n        }\n    }\n});\n\nAmplify.addPluggable(new AWSIoTProvider({\n  aws_pubsub_region: process.env.REACT_APP_REGION,\n  aws_pubsub_endpoint: `wss://${process.env.REACT_APP_MQTT_ID}.iot.${process.env.REACT_APP_REGION}.amazonaws.com/mqtt`,\n}));\n\nAmplify.addPluggable(new AmazonAIPredictionsProvider());\n\n\nconst StyledTextLoop = cxs(TextLoop)({\n  display: \"block\"\n});\n\n\nfunction SpeechToText(props) {\n  const [response, setResponse] = useState(\"Question from attendee will be displayed here.\")\n  \n  function AudioRecorder(props) {\n    const [recording, setRecording] = useState(false);\n    const [micStream, setMicStream] = useState();\n    const [audioBuffer] = useState(\n      (function() {\n        let buffer = [];\n        function add(raw) {\n          buffer = buffer.concat(...raw);\n          return buffer;\n        }\n        function newBuffer() {\n          console.log(\"reseting buffer\");\n          buffer = [];\n        }\n \n        return {\n          reset: function() {\n            newBuffer();\n          },\n          addData: function(raw) {\n            return add(raw);\n          },\n          getData: function() {\n            return buffer;\n          }\n        };\n      })()\n    );\n\n    async function startRecording() {\n      console.log('start recording');\n      audioBuffer.reset();\n\n      window.navigator.mediaDevices.getUserMedia({ video: false, audio: true }).then((stream) => {\n        const startMic = new mic();\n\n        startMic.setStream(stream);\n        startMic.on('data', (chunk) => {\n          var raw = mic.toRaw(chunk);\n          if (raw == null) {\n            return;\n          }\n          audioBuffer.addData(raw);\n\n        });\n\n        setRecording(true);\n        setMicStream(startMic);\n      });\n    }\n\n    async function stopRecording() {\n      console.log('stop recording');\n      const { finishRecording } = props;\n\n      micStream.stop();\n      setMicStream(null);\n      setRecording(false);\n\n      const resultBuffer = audioBuffer.getData();\n\n      if (typeof finishRecording === \"function\") {\n        finishRecording(resultBuffer);\n      }\n\n    }\n\n    return (\n      <div className=\"audioRecorder\">\n        <div>\n          {recording && <button onClick={stopRecording}>Stop recording</button>}\n          {!recording && <button onClick={startRecording}>Start recording</button>}\n        </div>\n      </div>\n    );\n  }\n\n  function convertFromBuffer(bytes) {\n    setResponse('Converting text...');\n    \n    Predictions.convert({\n      transcription: {\n        source: {\n          bytes\n        },\n        // language: \"en-US\", // other options are \"en-GB\", \"fr-FR\", \"fr-CA\", \"es-US\"\n      },\n    }).then(({ transcription: { fullText } }) => {\n        setResponse(fullText);\n        console.log(fullText);\n          })\n      .catch(err => setResponse(JSON.stringify(err, null, 2)));\n  }\n\n  return (\n    <div className=\"Text\">\n      <div>\n        <AudioRecorder finishRecording={convertFromBuffer} />\n// <AudioRecorder finishRecording={convertFromBuffer} />\n        <p>{response}</p>\n      </div>\n    </div>\n  );\n}\n\n\nclass LCD extends React.Component {\n  state = {\n    datalcd: null,\n    status: 'idle'\n  }\n  \n  componentDidMount() {\n    this.getSub()\n  }\n    getSub = () => {\n   const datalcd = Amplify.PubSub.subscribe('lcd-message').subscribe({\n  next: data => {\n    var answer = JSON.stringify(data);\n    var objectValue = JSON.parse(answer);\n    var messageiot = objectValue['value'].message;\n    console.log('tip: ', messageiot);\n    this.setState({datalcd: messageiot, status: 'presence'});\n  },\n  error: error => console.error(error),\n  close: () => console.log('Done'),\n});\n  }\n  render(){\n    const {datalcd, status} = this.state;\n      const { loading } = this.state;\n    return (\n      <div className=\"App\"style = {{height:\"130vh\", justifyContent: 'center'}}>\n      <SpeechToText />\n\n      <div className=\"Message\">\n      {status == \"idle\" ? <TextLoop interval='4000' fade='true' children={[\"How can I help?\", \"\t¿Cómo puedo ayudarte?\",<img src={AWS_logo} alt=\"Logo\" />]} /> : `AVA: ${datalcd}`}\n      \n       </div>\n       \n       {this.data}\n      </div>\n    );\n  }\n}\n\n\nfunction App() {\n\n  return (\n    <div className=\"App\"style = {{height:\"100vh\", justifyContent: 'center'}}>\n      {/*<button onClick={createNewTodo}>Add Todo</button>*/}\n\n      <div className=\"Message\">\n      <TextLoop interval='4000' fade='true' children={[\"How can I help?\", \"\t¿Cómo puedo ayudarte?\",<img src={AWS_logo} alt=\"Logo\" />]} />\n       </div>\n       {this.data}\n    </div>\n  );\n}\n\nexport default LCD;\n\n\n"]},"metadata":{},"sourceType":"module"}