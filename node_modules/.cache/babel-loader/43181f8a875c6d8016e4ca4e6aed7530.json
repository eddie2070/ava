{"ast":null,"code":"var _jsxFileName = \"/home/ec2-user/environment/myapp/src/App.js\";\nimport React, { useEffect, useReducer, useState } from 'react';\nimport API, { graphqlOperation } from '@aws-amplify/api';\nimport Amplify, { PubSub, Predictions } from 'aws-amplify';\nimport { AWSIoTProvider } from '@aws-amplify/pubsub/lib/Providers';\nimport { AmazonAIPredictionsProvider } from '@aws-amplify/predictions';\nimport TextLoop from \"react-text-loop\";\nimport cxs from \"cxs/component\";\nimport mic from 'microphone-stream';\nimport $ from 'jquery';\nimport { startbutton } from \"./lib/main.js\";\nimport AWS_logo from \"./images/AWS_logo_RGB_WHT.png\"; // Spinner lib\n\nimport { WaveSpinner } from \"react-spinners-kit\";\nimport awsconfig from './aws-exports';\nimport './App.css'; // IoT subscription\n\nAmplify.configure({\n  Auth: {\n    identityPoolId: process.env.REACT_APP_IDENTITY_POOL_ID,\n    region: process.env.REACT_APP_REGION,\n    userPoolId: process.env.REACT_APP_USER_POOL_ID,\n    userPoolWebClientId: process.env.REACT_APP_USER_POOL_WEB_CLIENT_ID\n  },\n  predictions: {\n    convert: {\n      transcription: {\n        region: \"us-east-1\",\n        proxy: false,\n        defaults: {\n          \"language\": \"en-US\"\n        }\n      }\n    }\n  }\n});\nAmplify.addPluggable(new AWSIoTProvider({\n  aws_pubsub_region: process.env.REACT_APP_REGION,\n  aws_pubsub_endpoint: `wss://${process.env.REACT_APP_MQTT_ID}.iot.${process.env.REACT_APP_REGION}.amazonaws.com/mqtt`\n}));\nAmplify.addPluggable(new AmazonAIPredictionsProvider());\nconst StyledTextLoop = cxs(TextLoop)({\n  display: \"block\"\n});\n\nfunction SpeechToText(props) {\n  const [response, setResponse] = useState(\"Question from attendee will be displayed here.\");\n\n  function AudioRecorder(props) {\n    const [recording, setRecording] = useState(false);\n    const [micStream, setMicStream] = useState();\n    const [audioBuffer] = useState(function () {\n      let buffer = [];\n\n      function add(raw) {\n        buffer = buffer.concat(...raw);\n        return buffer;\n      }\n\n      function newBuffer() {\n        console.log(\"reseting buffer\");\n        buffer = [];\n      }\n\n      return {\n        reset: function () {\n          newBuffer();\n        },\n        addData: function (raw) {\n          return add(raw);\n        },\n        getData: function () {\n          return buffer;\n        }\n      };\n    }());\n\n    async function startRecording() {\n      console.log('start recording');\n      audioBuffer.reset();\n      window.navigator.mediaDevices.getUserMedia({\n        video: false,\n        audio: true\n      }).then(stream => {\n        const startMic = new mic();\n        startMic.setStream(stream);\n        startMic.on('data', chunk => {\n          var raw = mic.toRaw(chunk);\n\n          if (raw == null) {\n            return;\n          }\n\n          var audiobuf = audioBuffer.addData(raw);\n        });\n        setRecording(true);\n        setMicStream(startMic);\n      });\n    }\n\n    async function stopRecording() {\n      console.log('stop recording');\n      const {\n        finishRecording\n      } = props;\n      micStream.stop();\n      setMicStream(null);\n      setRecording(false);\n      const resultBuffer = audioBuffer.getData();\n\n      if (typeof finishRecording === \"function\") {\n        finishRecording(resultBuffer);\n      }\n    }\n\n    return React.createElement(\"div\", {\n      className: \"audioRecorder\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134\n      },\n      __self: this\n    }, recording && React.createElement(\"button\", {\n      onClick: stopRecording,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135\n      },\n      __self: this\n    }, \"Stop recording\"), !recording && React.createElement(\"button\", {\n      onClick: startRecording,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }, \"Start recording\")));\n  }\n\n  function convertFromBuffer(bytes) {\n    setResponse('Converting text...');\n    Predictions.convert({\n      transcription: {\n        source: {\n          bytes\n        } // language: \"en-US\", // other options are \"en-GB\", \"fr-FR\", \"fr-CA\", \"es-US\"\n\n      }\n    }).then(({\n      transcription: {\n        fullText\n      }\n    }) => {\n      setResponse(fullText);\n      console.log(fullText);\n    }).catch(err => setResponse(JSON.stringify(err, null, 2)));\n  }\n\n  return React.createElement(\"div\", {\n    className: \"Text\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }, React.createElement(AudioRecorder, {\n    finishRecording: convertFromBuffer,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162\n    },\n    __self: this\n  }), React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, response)));\n}\n\nclass LCD extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      datalcd: null,\n      status: 0\n    };\n\n    this.getSub = () => {\n      const datalcd = Amplify.PubSub.subscribe('lcd-message').subscribe({\n        next: data => {\n          var answer = JSON.stringify(data);\n          console.log('answer: ', answer);\n          var objectValue = JSON.parse(answer);\n          var messageiot = objectValue['value'].message;\n          console.log('tip: ', messageiot);\n          var presenceiot = objectValue['value'].presence;\n          console.log('status: ', presenceiot);\n          this.setState({\n            datalcd: messageiot,\n            status: presenceiot\n          });\n        },\n        error: error => console.error(error),\n        close: () => console.log('Done')\n      });\n    };\n  }\n\n  componentDidMount() {\n    this.getSub();\n    $('#start-button').click(function () {\n      $('#error').hide(); // hide any existing errors\n\n      toggleStartStop(true); // disable start and enable stop button\n      // set the language and region from the dropdowns\n\n      setLanguage();\n      setRegion(); // first we get the microphone input from the browser (as a promise)...\n\n      window.navigator.mediaDevices.getUserMedia({\n        video: false,\n        audio: true\n      }) // ...then we convert the mic stream to binary event stream messages when the promise resolves \n      .then(streamAudioToWebSocket).catch(function (error) {\n        showError('There was an error streaming your audio to Amazon Transcribe. Please try again.');\n        toggleStartStop();\n      });\n    });\n  }\n\n  render() {\n    const {\n      datalcd,\n      status\n    } = this.state;\n    const {\n      loading\n    } = this.state;\n    const welcome = 'How can I help?';\n    return React.createElement(\"div\", {\n      className: \"App\",\n      style: {\n        height: \"130vh\",\n        justifyContent: 'center'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222\n      },\n      __self: this\n    }, React.createElement(SpeechToText, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"Message\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225\n      },\n      __self: this\n    }, status === 0 ? React.createElement(TextLoop, {\n      interval: \"4000\",\n      fade: \"true\",\n      children: [\"ASK ME\", React.createElement(\"img\", {\n        src: AWS_logo,\n        alt: \"Logo\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      })],\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226\n      },\n      __self: this\n    }) : null, status === 1 ? \"How can I help?\" : null, status === \"request\" ? `AVA: ${datalcd}` : null), React.createElement(\"textarea\", {\n      id: \"transcript\",\n      placeholder: \"Press Start and speak into your mic\",\n      rows: \"5\",\n      readonly: \"readonly\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      class: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      class: \"col\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      onClick: startbutton,\n      class: \"button-xl\",\n      title: \"Start Transcription\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      class: \"fa fa-microphone\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    }), \" Start\"), React.createElement(\"button\", {\n      id: \"stop-button\",\n      class: \"button-xl\",\n      title: \"Stop Transcription\",\n      disabled: \"true\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      class: \"fa fa-stop-circle\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238\n      },\n      __self: this\n    }), \" Stop\"), React.createElement(\"button\", {\n      id: \"reset-button\",\n      class: \"button-xl button-secondary\",\n      title: \"Clear Transcript\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    }, \"Clear Transcript\")), React.createElement(\"div\", {\n      class: \"col\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }, React.createElement(\"a\", {\n      class: \"float-right\",\n      href: \"https://aws.amazon.com/free/\",\n      \"aria-label\": \"Amazon Web Services\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      id: \"logo\",\n      src: \"AWS_logo_RGB.png\",\n      alt: \"AWS Logo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    })))), React.createElement(\"script\", {\n      src: \"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251\n      },\n      __self: this\n    }), React.createElement(\"script\", {\n      src: \"dist/main.js\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252\n      },\n      __self: this\n    }), this.data);\n  }\n\n}\n\nexport default LCD;","map":{"version":3,"sources":["/home/ec2-user/environment/myapp/src/App.js"],"names":["React","useEffect","useReducer","useState","API","graphqlOperation","Amplify","PubSub","Predictions","AWSIoTProvider","AmazonAIPredictionsProvider","TextLoop","cxs","mic","$","startbutton","AWS_logo","WaveSpinner","awsconfig","configure","Auth","identityPoolId","process","env","REACT_APP_IDENTITY_POOL_ID","region","REACT_APP_REGION","userPoolId","REACT_APP_USER_POOL_ID","userPoolWebClientId","REACT_APP_USER_POOL_WEB_CLIENT_ID","predictions","convert","transcription","proxy","defaults","addPluggable","aws_pubsub_region","aws_pubsub_endpoint","REACT_APP_MQTT_ID","StyledTextLoop","display","SpeechToText","props","response","setResponse","AudioRecorder","recording","setRecording","micStream","setMicStream","audioBuffer","buffer","add","raw","concat","newBuffer","console","log","reset","addData","getData","startRecording","window","navigator","mediaDevices","getUserMedia","video","audio","then","stream","startMic","setStream","on","chunk","toRaw","audiobuf","stopRecording","finishRecording","stop","resultBuffer","convertFromBuffer","bytes","source","fullText","catch","err","JSON","stringify","LCD","Component","state","datalcd","status","getSub","subscribe","next","data","answer","objectValue","parse","messageiot","message","presenceiot","presence","setState","error","close","componentDidMount","click","hide","toggleStartStop","setLanguage","setRegion","streamAudioToWebSocket","showError","render","loading","welcome","height","justifyContent"],"mappings":"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","sourcesContent":["import React, { useEffect, useReducer, useState } from 'react';\n\nimport API, { graphqlOperation } from '@aws-amplify/api';\nimport Amplify, { PubSub, Predictions } from 'aws-amplify';\nimport { AWSIoTProvider } from '@aws-amplify/pubsub/lib/Providers';\nimport { AmazonAIPredictionsProvider } from '@aws-amplify/predictions';\n\n\nimport TextLoop from \"react-text-loop\";\nimport cxs from \"cxs/component\";\n\nimport mic from 'microphone-stream';\nimport $ from 'jquery';\nimport { startbutton } from \"./lib/main.js\";\n\n\nimport AWS_logo from \"./images/AWS_logo_RGB_WHT.png\"\n\n// Spinner lib\nimport { WaveSpinner } from \"react-spinners-kit\";\n\n\nimport awsconfig from './aws-exports';\nimport './App.css';\n\n// IoT subscription\n\nAmplify.configure({\n  Auth: {\n    identityPoolId: process.env.REACT_APP_IDENTITY_POOL_ID,\n    region: process.env.REACT_APP_REGION,\n    userPoolId: process.env.REACT_APP_USER_POOL_ID,\n    userPoolWebClientId: process.env.REACT_APP_USER_POOL_WEB_CLIENT_ID,\n  },\n  predictions: {\n        convert: {\n            transcription: {\n                region: \"us-east-1\",\n                proxy: false,\n                defaults: {\n                    \"language\": \"en-US\"\n                }\n            }\n        }\n    }\n});\n\nAmplify.addPluggable(new AWSIoTProvider({\n  aws_pubsub_region: process.env.REACT_APP_REGION,\n  aws_pubsub_endpoint: `wss://${process.env.REACT_APP_MQTT_ID}.iot.${process.env.REACT_APP_REGION}.amazonaws.com/mqtt`,\n}));\n\nAmplify.addPluggable(new AmazonAIPredictionsProvider());\n\n\nconst StyledTextLoop = cxs(TextLoop)({\n  display: \"block\"\n});\n\n\n\nfunction SpeechToText(props) {\n  const [response, setResponse] = useState(\"Question from attendee will be displayed here.\")\n  \n  function AudioRecorder(props) {\n    const [recording, setRecording] = useState(false);\n    const [micStream, setMicStream] = useState();\n    const [audioBuffer] = useState(\n      (function() {\n        let buffer = [];\n        function add(raw) {\n          buffer = buffer.concat(...raw);\n          return buffer;\n        }\n        function newBuffer() {\n          console.log(\"reseting buffer\");\n          buffer = [];\n        }\n \n        return {\n          reset: function() {\n            newBuffer();\n          },\n          addData: function(raw) {\n            return add(raw);\n          },\n          getData: function() {\n            return buffer;\n          }\n        };\n      })()\n    );\n\n    async function startRecording() {\n      console.log('start recording');\n      audioBuffer.reset();\n\n      window.navigator.mediaDevices.getUserMedia({ video: false, audio: true }).then((stream) => {\n        const startMic = new mic();\n\n        startMic.setStream(stream);\n        startMic.on('data', (chunk) => {\n          var raw = mic.toRaw(chunk);\n          if (raw == null) {\n            return;\n          }\n          var audiobuf = audioBuffer.addData(raw);\n\n        });\n        \n        setRecording(true);\n        setMicStream(startMic);\n      });\n    }\n\n    async function stopRecording() {\n      console.log('stop recording');\n      const { finishRecording } = props;\n\n      micStream.stop();\n      setMicStream(null);\n      setRecording(false);\n\n      const resultBuffer = audioBuffer.getData();\n\n      if (typeof finishRecording === \"function\") {\n        finishRecording(resultBuffer);\n      }\n\n    }\n\n    return (\n      <div className=\"audioRecorder\">\n        <div>\n          {recording && <button onClick={stopRecording}>Stop recording</button>}\n          {!recording && <button onClick={startRecording}>Start recording</button>}\n        </div>\n      </div>\n    );\n  }\n\n  function convertFromBuffer(bytes) {\n    setResponse('Converting text...');\n    \n    Predictions.convert({\n      transcription: {\n        source: {\n          bytes\n        },\n        // language: \"en-US\", // other options are \"en-GB\", \"fr-FR\", \"fr-CA\", \"es-US\"\n      },\n    }).then(({ transcription: { fullText } }) => {\n        setResponse(fullText);\n        console.log(fullText);\n          })\n      .catch(err => setResponse(JSON.stringify(err, null, 2)));\n  }\n\n  return (\n    <div className=\"Text\">\n      <div>\n        <AudioRecorder finishRecording={convertFromBuffer} />\n        <p>{response}</p>\n      </div>\n    </div>\n  );\n}\n\n\nclass LCD extends React.Component {\n  state = {\n    datalcd: null,\n    status: 0\n  }\n  \n  componentDidMount() {\n    this.getSub()\n    \n    $('#start-button').click(function () {\n    $('#error').hide(); // hide any existing errors\n    toggleStartStop(true); // disable start and enable stop button\n\n    // set the language and region from the dropdowns\n    setLanguage();\n    setRegion();\n\n    // first we get the microphone input from the browser (as a promise)...\n    window.navigator.mediaDevices.getUserMedia({\n            video: false,\n            audio: true\n        })\n        // ...then we convert the mic stream to binary event stream messages when the promise resolves \n        .then(streamAudioToWebSocket) \n        .catch(function (error) {\n            showError('There was an error streaming your audio to Amazon Transcribe. Please try again.');\n            toggleStartStop();\n        });\n    });\n  }\n    getSub = () => {\n   const datalcd = Amplify.PubSub.subscribe('lcd-message').subscribe({\n  next: data => {\n    var answer = JSON.stringify(data);\n    console.log('answer: ', answer);\n    var objectValue = JSON.parse(answer);\n    var messageiot = objectValue['value'].message;\n    console.log('tip: ', messageiot);\n    var presenceiot = objectValue['value'].presence;\n    console.log('status: ', presenceiot);\n    this.setState({datalcd: messageiot, status: presenceiot});\n  },\n  error: error => console.error(error),\n  close: () => console.log('Done'),\n});\n  }\n\n  render(){\n    const {datalcd, status} = this.state;\n      const { loading } = this.state;\n    const welcome = 'How can I help?';\n    return (\n      <div className=\"App\"style = {{height:\"130vh\", justifyContent: 'center'}}>\n      <SpeechToText />\n\n      <div className=\"Message\">\n      {(status === 0) ? <TextLoop interval='4000' fade='true' children={[\"ASK ME\", <img src={AWS_logo} alt=\"Logo\" />]} /> : null}\n      {(status === 1) ? \"How can I help?\" : null }\n      {(status === \"request\") ? `AVA: ${datalcd}`  : null}\n       </div>\n       \n               <textarea id=\"transcript\" placeholder=\"Press Start and speak into your mic\" rows=\"5\"\n            readonly=\"readonly\"></textarea>\n        <div class=\"row\">\n            <div class=\"col\">\n                <button onClick={startbutton} class=\"button-xl\" title=\"Start Transcription\">\n                    <i class=\"fa fa-microphone\"></i> Start\n                </button>\n                <button id=\"stop-button\" class=\"button-xl\" title=\"Stop Transcription\" disabled=\"true\"><i\n                        class=\"fa fa-stop-circle\"></i> Stop\n                </button>\n                <button id=\"reset-button\" class=\"button-xl button-secondary\" title=\"Clear Transcript\"> \n                    Clear Transcript\n                </button>\n            </div>\n            <div class=\"col\">\n                <a class=\"float-right\" href=\"https://aws.amazon.com/free/\" aria-label=\"Amazon Web Services\">\n                    <img id=\"logo\" src=\"AWS_logo_RGB.png\" alt=\"AWS Logo\" />\n                </a>\n            </div>\n        </div>\n          <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js\"></script>\n          <script src=\"dist/main.js\"></script>\n\n       {this.data}\n      </div>\n    );\n  }\n}\n\n\nexport default LCD;\n\n\n"]},"metadata":{},"sourceType":"module"}